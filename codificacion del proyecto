//Jose J. Hernandez Ortega
// Janluis Lebron Rivera
//Ángel Hernández
//COMP2120.PROGRAMMING LOGIC
//Proyecto final

#include <iostream>
#include <string>
#include <vector>
#include <algorithm>
#include <limits>

using namespace std;

// VARIABLES

bool programaActivo = true;
int opcion = 0;
int bpm = 0;
string rutaArchivo = "";
int resultadoDeteccion = 0;

// Constantes de BPM permitidas
const int BPM_MIN = 40;
const int BPM_MAX = 240;


// esto funciona para que el int entero en rango
// Pide un número al usuario y valida que esté en un rango.
//parte Angel
int leerEnteroEnRango(const string& mensaje, int minimo, int maximo) {
    int valor = 0;

    while (true) { //sigue pidiendo el valor hasta que sea valido
        cout << mensaje;

        if (cin >> valor && valor >= minimo && valor <= maximo) { //Intenta leer el numero
            break; //aceptado, sale del loop cua el v este di rang
        } else {
            cin.clear(); //Limpia el estadocde error si el usuario escribe el txt
            cin.ignore(numeric_limits<streamsize>::max(), '\n'); //evita un loop infinito
            cout << "Número inválido. Debe estar entre " << minimo
                 << " y " << maximo << ".\n";
        }
    }

    return valor;
}


// esta parte es para detectarBPMConAubio 
//Parte de Jose 
int detectarBPMConAubio(const string& ruta) {
    (void)ruta; // evita el warning para la variable no usada
    cout << "[Info] La detección automática REAL no está implementada.\n";
    return -1; 
}


// esto es para detectar el BPM

int detectarBPM(const string& ruta) {
    cout << "\n[Info] Intentando detectar BPM para: " << ruta << "\n";

    int autoBPM = detectarBPMConAubio(ruta);

    if (autoBPM < 0) {
        cout << "[Advertencia] Falló la detección automática.\n";
        autoBPM = leerEnteroEnRango("Ingrese BPM manualmente (40–240): ",
                                    BPM_MIN, BPM_MAX);
    }

    return autoBPM;
}


// Estor es para mostrarMenu

void mostrarMenu() {
    cout << "\n=== Detector de BPM (Versión Manual) ===\n"
         << "1) Detectar BPM de un archivo de audio\n"
         << "0) Salir\n> ";
}
//Hasta aqui

// esta es función principal

int main() {

    while (programaActivo) {
        mostrarMenu();

        if (!(cin >> opcion)) {
            cin.clear();
            cin.ignore(numeric_limits<streamsize>::max(), '\n');
            cout << "Entrada inválida.\n";
            continue;
        }

        if (opcion == 1) {
            cin.ignore(numeric_limits<streamsize>::max(), '\n'); 

            cout << "Ingrese la ruta del archivo (.wav o .mp3): ";
            getline(cin, rutaArchivo);

            bpm = detectarBPM(rutaArchivo);

            cout << "\nResultado:\n";
            cout << "  Archivo : " << rutaArchivo << "\n";
            cout << "  BPM     : " << bpm << "\n";
        }
        else if (opcion == 0) {
            programaActivo = false;
        }
        else {
            cout << "Opción inválida.\n";
        }
    }

    cout << "¡Hasta luego!\n";
    return 0;   
}
